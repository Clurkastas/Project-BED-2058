---
title: "Which is the best country to live in?"
author: "Kirill Tumanov, Mattia Storero, Lucas Stark"
date: "14 12 2019"
output: 
  html_document:
    number_sections: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
rm(list=ls()) #delete workspace
knitr::opts_chunk$set(echo = F, include = T, warning=F, error=F)

### Cleaning and Visualizing
library(maps) #this way we can visualize data on maps (-> world map)
library(tidyverse) #basic cleaning/ organising functions
library(plotrix) #3D pie chart
library(ggpubr) #chart mattia

#load data
#data was gathered and cleand in "DataCollectionAndCleaning.R"
dat_raw  <- read.csv("dat_raw.csv")
dat_wide <- read.csv("dat_wide.csv")
dat_long <- read.csv("dat_long.csv")


```

# Background
The idea of this project was created in middle of September 2019.
Three guys, from different lands had some discussions about their countries.
Then, we started to think about particular question:
"Which is the world's best country to live in?"

To receive an answer for this attractive question we decided to select some 
variables, which were considerable for us.


```{r pie chart, include = T}
# 3D Exploded Pie Chart
slices <- c(20, 20, 20, 20, 20)
lbls <- c("Health", "Economics", "Safety", "Education", "Environment")
pie3D(slices,labels=lbls,explode=0.1,
   main="Pie Chart of Variables ")
```

The first significant indicator for us was health, which included: 
Life expectancy (gapminder)
Child mortality (The world bank data)
Survival to age 65 by both genders (The world bank data)
Water Supply (The world bank data)

The second essential variable for us was Economics (Jobs/ Income), which included:
Inequality, gini coefficient (The world bank data)
Income, GDP (gapminder)
Unemployment rate at the age of 25 - 54 (The world bank data)

The third vital marker for us was Safety, which included:
Traffic deaths (gapminder)
Murders/100k (The world bank data)

The fourth considerable indicator for us was Education, which included:
Gender ratio of mean age in education (The world bank data)
Mean years in school (age group 25-54) (The world bank data)

The fifth substantial marker for us was Environment, we used:
CO2 emissions, tonnes per person (The world bank data)
Air pollution (The world bank data)

# Research Question
To create a well-developed project, we asked the following questions:
What is the current state of the indicator (2019 or the last year)?
How did it develop over the years?
How is it distributed over the continents?


# Data Analysis

```{r analysis beginning, include = T}
temp <- dat_wide %>%
  mutate(meta = (envir + health + econ + educ + secu)/5) %>%
  arrange(-meta) %>%
  mutate(worst10 = as.factor(ifelse(rank(meta)<=10,1,0)),
         top10 = as.factor(ifelse(rank(meta)>=(length(meta)-10),1,0)))

#world map
thismap <- map_data("world")
thismap$region[thismap$region=="Democratic Republic of the Congo"] <- "Congo, Dem. Rep."
thismap$region[thismap$region=="Republic of Congo"] <- "Congo, Rep."
temp2 <- temp[,c("country","meta")]
temp2$country <- as.character(temp2$country)
temp2$country[temp2$country=="United States"] <- "USA"
temp2$country[temp2$country=="United Kingdom"] <- "UK"
thismap2 <- full_join(thismap, temp2, 
                     by = c("region" = "country")) 
ggplot(thismap2, aes(long, lat, group=group, fill=meta), color = "white") +
  scale_fill_gradient(limits=range(thismap2$meta), low="red", high="green", na.value = "white") + 
  geom_polygon(show.legend = T) +
  scale_y_continuous(limits = c(-60,max(thismap$lat))) + 
  coord_fixed(1.3) + #this makes the right proportions for the image
  theme(panel.background = element_rect(fill = 'lightblue', colour = 'black'))+
  ggtitle("Life Quality across the World")

#meta and population
temp %>%
  ggplot(aes(x=log10(pop), y=meta, col=continent, label=country, size=pop)) +
  geom_point() +
  geom_smooth(col="blue", method = 'lm') +
  ggtitle("Life Quality dependend on Population Size")

```

What this method does?
For this method, we created a new variable, which is called "meta". It includes sum of 5 variables 
such as environment, health, economics, education and security. After we divided it for 5 (number of variables) and arranged it.

What is the result of it?
According for our data, the best country to live in is Norway with 1.81 points, the second place Ireland takes and the
third is Singapore. On the bottom of our rating is located Chad.


```{r}
ggplot(data = temp[c(1:10,(length(temp$country)-10):length(temp$country)),], mapping = aes(x = -rank(meta), y = meta,  fill = continent)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=country, y = meta/2), size = 5, angle = 90) +
labs(x = "Countries", y = "Points", title = "Top 10 and Bottom 10 Countries in Life Quality")

```

This graph shows us top 10 best countries for living and top 10 worst countries. We ranked them by continents.

## Health Variables Lucas
```{r}
ggplot(data = temp[c(1:10,(length(temp$country)-10):length(temp$country)),], mapping = aes(x = -rank(health), y = health,  fill = continent)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=country, y = health/2), size = 5, angle = 90)

health <- c("surv_65m","surv_65f","mortality","lifeExp","cook","child_mor")

temp %>% ggplot(aes(x=surv_65m,y=surv_65f, col=continent)) +
  geom_point() +
  geom_text(dat=temp[temp$top10==1|temp$worst10==1,], aes(label=country))

```

## Economic Variables Mattia
```{r}
ggplot2::ggplot(data = temp[c(1:10,(length(temp$country)-10):length(temp$country)),], mapping = aes(x = -rank(econ), y = econ,  fill = continent)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=country, y = econ/2), size = 5, angle = 90)

ggplot(data = dat_long[dat_long$variable=="gdpPercap"& dat_long$country=="Norway"|dat_long$variable=="gini"& dat_long$country=="Norway"|dat_long$variable=="unemp" & dat_long$country=="Norway",], mapping = aes(x = country, y = measurement,  fill = variable, group = variable)) +
  geom_bar(stat = "identity",position = "dodge") #+
  geom_text(aes(label=country, y = econ/2), size = 5, angle = 90)
  

ep1 <- temp %>% 
  ggplot(aes(x = gdpPercap, y = gini,
             col = continent)) +
  geom_text(dat=temp[temp$top10==1|temp$worst10==1,], aes(label=country)) +
  geom_point()
  
ep2 <- temp %>% 
  ggplot(aes(x = gdpPercap, y = unemp, 
             col = continent)) +
  geom_text(dat=temp[temp$top10==1|temp$worst10==1,], aes(label=country)) +
  geom_point()  
  
  
ep3 <-  temp %>% 
  ggplot(aes(x = gini, y = unemp, 
             col = continent)) +
  geom_text(dat=temp[temp$top10==1|temp$worst10==1,], aes(label=country)) +
  geom_point()
```

## Safety Variables Kirill
```{r}
ggplot(data = temp[c(1:10,(length(temp$country)-10):length(temp$country)),], mapping = aes(x = -rank(secu), y = secu,  fill = continent)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=country, y = secu/2), size = 5, angle = 90) +
  labs(x = "Countries", y = "Points", title = "Top 10 best and top 10 worst countries for safety") +
  scale_y_continuous(limits =  c(-3.2,1))
```

This graph shows us top 10 best countries, where people can feel them calm and top 10 worst countries for safety.
We ranked them by continents. After we separated safety for 3 variables and made 2 plots.

```{r}
temp %>% 
  ggplot(aes(x = mor_hyg, y = poison,
             col = continent)) +
  geom_point() +
  geom_text(dat=temp[temp$worst10==1,], aes(label=country)) +
  labs(x = "Mortality due to lack of hygiene", y = "Mortality due to unintentional poisoning", title = "Mortality due to lack of hygiene and unintentional poisoning (per 100,000 population)")
```

This graph shows us the rate of mortality due to 2 reasons: mortality due to lack of hygiene and mortality due to unintentional poisoning. It is clearly seen, that African countries are leaders in mortality in both categories.

```{r}
temp2 <- temp[c(1:10,(length(temp$country)-10):length(temp$country)),] %>%
  mutate(rank = rank(road))
temp2$rank[temp2$country=="Japan"] <- 5
temp2$rank[temp2$country=="Ireland"] <- 6

ggplot(data = temp2, mapping = aes(x = rank, y = road,  fill = continent)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=country, y = road/2), size = 5, angle = 90) +
   labs(x = "Countries", y = "Mortality on roads", title = "Top 10 best and top 10 worst countries for mortality caused by road traffic injury (per 100,000 people)")
```

This graph shows us the rate of mortality caused by road traffic injury. We put on the graph top 10 best and top 10 worst countries according to this indicator. African countries have high level of road mortality. For example, in Burundi, Congo Dem. Rep., Central African Republic, Cameron and South Sudan >= 30 out of 100,000 people die on roads. As for top best 8 counties, less than 5 out of 100,000 people die on roads.

## Educational variables Lucas
```{r, include = T}
ggplot(data = temp[c(1:10,(length(temp$country)-10):length(temp$country)),], mapping = aes(x = -rank(educ), y = educ,  fill = continent)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label=country, y = educ/2), size = 5, angle = 90)

educ <- c("pri_ed","sec_ed","pri_mon","sec_mon")
temp_ed <- dat_long[str_detect(dat_long$variable,paste(educ, collapse="|")),]
temp_ed <- left_join(temp_ed,temp[,c("country","educ","top10","worst10")],by="country") %>%
  mutate(variable = as.factor(as.character(temp_ed$variable)))
levels(temp_ed$variable) <- c("% of children in primary education",
                              "% of students receiving money transfers from state for primary education",
                              "% of children in secondary education",
                              "% of students receiving money transfers from state for secondary education")

#graph
temp_ed %>%
  ggplot(aes(x=educ, y= measurement, label=country)) +
  geom_point(col="grey") +
  geom_text(dat=temp_ed[temp_ed$top10==1,], aes(label=country), color="green", size=3)+
  geom_text(dat=temp_ed[temp_ed$worst10==1,], aes(label=country), color="red", size=3) +
  facet_wrap(~variable)

```

## Environmental variables Kirill
```{r}
temp %>% 
  ggplot(aes(x = CO2, y = air,
             col = continent)) +
  geom_text(dat=temp[temp$top10==1|temp$worst10==1,], aes(label=country)) +
  geom_point() +
  labs(x = "CO2 emissions", y = "Air pollution, micrograms/cubic meter", title = "Environment in different countries, ranked by continents and 2 variables")
```

This graph shows us environmental situations in different countries. Almost all African countries have a high degree of air pollution, but low CO2 emissions. The situation with european countries is completely different. They have a high level of CO2 emissions and not as much air pollution as African countries.
This may be due to the fact that CO2 emissions in Europe are less toxic due to various technologies that reduce air pollution. There are no such technologies in Africa.

# Conclussion
