---
title: "Which is the best country to live in?"
author: "Kirill Tumanov, Mattia Storero, Lucas Stark"
date: "14 12 2019"
output: 
  html_document:
    number_sections: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, include = F)
### Data 
library(OECD) #connection to OECD database
library(eurostat) #connection to eurostat database
library(wbstats) #connection 1 to world bank
library(WDI) #connection 2 or world bank
library(Quandl) #connection to Quandl
library(gapminder) #data from gapminder
### Cleaning and Visualizing
library(rvest) #if we need to harvest data from webpages
library(ggmap) #this way we can visualize data on maps (-> world map)
library(tidyverse) #basic cleaning/ organising functions
```

# Background
The idea of this project was created in middle of September 2019.
Three guys, from different lands had some discussions about their countries.
Then, we started to think about particular question:
"Which is the world's best country to live in?"

To receive an answer for this attractive question we decided to select some 
variables, which were considerable for us.

The first significant indicator for us was health, which included: 
Life expectancy (gapminder)
Child mortality (gapminder)
Survival to age 65 by both genders (knoema)
Water Supply (knoema)

The second essential variable for us was Economics (Jobs/ Income), which included:
Inequality, gini coefficient (gapminder)
Income, GDP (gapminder)
Unemployment rate at the age of 25 - 54 (gapminder)

The third important indicator for us was Life Satisfaction, we used OECD database.

The fourth vital marker for us was Safety, which included:
Corruption Perception Index (gapminder)
Traffic deaths (gapminder)
Murders/100k (The world bank data)

The fifth considerable indicator for us was Education, which included:
Gender ratio of mean age in education (DATA BASE?)
Mean years in school (age group 25-54) (DATA BASE?)

The sixth substantial marker for us was Environment, we used CO2 emissions, tonnes per person (gapminder)

# Research Question
To create a well-developed project, we asked the following questions:
What is the current state of the indicator (2019 or the last year)?
How did it develop over the years?
How is it distributed over the continents?

# Data Sources
```{r import}
### 1 OECD ###
#- load table with all available variables
OECDdatasets <- get_datasets()
temp <- stringr::str_detect(OECDdatasets[["title"]], "")
temp2 <- OECDdatasets[temp,]
OECD_unemployment <- get_dataset("AVD_DUR")

### 2 EUROSTAT ###
#- load table with all available variables
ES_datasets <- search_eurostat("")
#df <- get_eurostat()

### 3 WORLD BANK ###
#- load table with all available variables
WDI_datasets <- as_tibble(WDIcache()$series)
temp <- stringr::str_detect(WDI_datasets[["name"]], "income")
temp2 <- WDI_datasets[temp,]
#temp2[["description"]]
#load datasets:
# HEALTH #######################
WDI_ch_mor <- WDI(indicator = "SP.DYN.IMRT.IN") #Child mortality source 1
WDI_ch_mor2 <- WDI(indicator = "HD.HCI.MORT") #Child mortality source 2
WDI_surv_65f <- WDI(indicator = "SP.DYN.TO65.FE.ZS") #survival to 65, female
WDI_surv_65m <- WDI(indicator = "SP.DYN.TO65.MA.ZS") #survival to 65, male
WDI_mor_hyg <- WDI(indicator = "SH.STA.WASH.P5") #deaths bcs of unclean water & bad hygience
#water is dichotom and has almost no variance
WDI_water2 <- WDI(indicator="SG.H2O.PRMS.HH.ZS") #water access in households
WDI_cook <- WDI(indicator = "EG.CFT.ACCS.ZS	") # access for clean cooking
WDI_mortality <- WDI(indicator = "SH.STA.AIRP.P5") #mortality rate attributed to household and ambient air pollution
# too much missing data
# EDUCATION ##################### Lucas
WDI_pri_Ed <- WDI(indicator = "UIS.NERT.1") # % in primary education
WDI_sec_Ed <- WDI(indicator = "UIS.NERA.3") # % in upper secondary education
WDI_pri_mon <- WDI(indicator = "fin37.t.a.5") # %Gov. transfers money for pri. ed.
WDI_sec_mon <- WDI(indicator = "fin37.t.a.6") # % Gov. transfers money for sec. ed.
WDI_ed_dur <- WDI(indicator = "SE.SEC.DURS")
WDI_sec_f <- WDI(indicator = "UIS.GTVP.23.GPV.F")
WDI_pri_out <- WDI(indicator = "UIS.ROFSPPT.1") #out-of-primary-students, maybe not useful additionally
WDI_ed_exp <- WDI(indicator = "UIS.XPUBP.UK")#gov. exp. on ed. %of total exp.
# SAFETY ###################
WDI_road <- WDI(indicator = "SH.STA.TRAF.P5") # traffic deaths per 1000
WDI_pois <- WDI(indicator = "SH.STA.POIS.P5") # poison deaths per 1000
WDI_murder <- WDI(indicator = "VC.IHR.PSRC.P5") #intentional homicide per 100,000
# ECONOMICS ################## Mattia
WDI_gini <- WDI(indicator = "SI.POV.GINI") # Gini Index
WDI_unemp <- WDI(indicator = "SL.UEM.LTRM.ZS") # % of total Unemployment
WDI_y_unemp <- WDI(indicator = "SL.UEM.1524.NE.ZS	") # % youth unemployment rate 
WDI_ad_unemp <- WDI(indicator = "SL.UEM.ADVN.ZS") # % unemployment rate with advance education 
WDI_int_unemp <- WDI(indicator = "SL.UEM.INTM.ZS") # % unemployment rate with intermediate education
WDI_bas_unemp <- WDI(indicator = "SL.UEM.BASC.ZS") # % unemployment rate with basic education 
WDI_gdp <- WDI(indicator = "6.0.GDPpc_constant") # per capita gdp
WDI_gdpgr <- WDI(indicator = "6.0.GDP_growth") #gdp growth

# ENVIRONMENT #################### Kirill
WDI_water_stress <- WDI(indicator = "ER.H2O.FWST.ZS") #Level of water stress
WDI_renewable_water <- WDI(indicator = "ER.H2O.INTR.PC") # Renewable internal freshwater resources per capita 
WDI_CO2 <- WDI(indicator = "EN.ATM.CO2E.KT") # CO2 emissions (kt)
WDI_air <- WDI(indicator = "EN.ATM.PM25.MC.M3") # Air pollution

WDI_pollut_glass <- WDI(indicator = "EE.BOD.CGLS.ZS") # Water pollution, clay and glass industry
WDI_pollut_chemical <- WDI(indicator = "EE.BOD.CHEM.ZS") # Water pollution, chemical industry
WDI_pollut_food <- WDI(indicator = "EE.BOD.FOOD.ZS") # Water pollution, food industry
WDI_pollut_metal <- WDI(indicator = "EE.BOD.MTAL.ZS") # Water pollution, metal industry
WDI_pollut_other <- WDI(indicator = "EE.BOD.OTHR.ZS") # Water pollution, other industry 
WDI_pollut_paper <- WDI(indicator = "EE.BOD.PAPR.ZS") # Water pollution, paper and pulp industry
WDI_pollut_textile <- WDI(indicator = "EE.BOD.TXTL.ZS") # Water pollution, textile industry 
WDI_pollut_wood <- WDI(indicator = "EE.BOD.WOOD.ZS") # Water pollution, wood industry 


WDI_road %>% group_by(country) %>% 
  summarise(mean = mean(.[[3]], na.rm=T)) %>%
  is.na() %>% summary() #TRUEs = missings for country

### 4 Quandl ###
#- a way to search for datasets:
Q_datasets <- Quandl.search("murder")
# load datasets:
# df <- Quandl(code)
Q_lifeExp <- Quandl("22254767")
Q_x2 <- Quandl("")

### 5 Gapminder ###
#- 6 variables: country, continent, year, lifeExp, pop, gdpPercap
summary(gapminder)
summary(country_codes) #can be added to gapminder data for country codes
col_gap <- cbind(country_colors,continent_colors, labels(country_colors)) %>% as.tibble()
names(col_gap) <- c("cntry_col","cntnt_col","country")
dat_gap <- left_join(gapminder, country_codes)
dat_gap <- left_join(dat_gap, col_gap)

### JOINING DATA ###
#join by country and year
# what?: a lot of WDI_variables and the dat_gap

datlist <- list(WDI_ED_pri, WDI_ED_sec, WDI_ch_mor, #from 3 WDI
                gapminder) #from 5 gapminder

dat <- plyr::join_all(dfs = datlist, by = c("country","year"))

#Open Questions:
#-which variables exactly
#-Weighing (each group = 1/6, 
            #maybe scalable as web application?,
            #make model from OECD life satisfaction -> apply to world)
# Exploratory Factor Analysis  <-- We will try this
# include size of country as support quality variable
#-handling missing data (missings probably not random)
#-relations between variables

# Want:
#- A plot which shows multiple placements from multiple variables to see which countries show always better values and which never do. (+ To see variance) => z-standardize and compare

```




# Data Cleaning
```{r cleaning}

```

# Data Analysis
```{r analysis}

```

## Health Variables

## Economic Variables

## Life Satisfaction variables

## Safety Variables

## Educational variables

## Environmental variables

# Conclussion


